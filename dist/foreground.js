(()=>{"use strict";var t;function e(t,e){if(null===t)return[0,0];let n=t.parentElement||t,o=0,s=e.anchorOffset||0;do{o+=n.offsetTop||0,s+=n.offsetLeft||0,n=n.offsetParent}while(n);return[o,s]}function n(t){t.stopImmediatePropagation()}function o(t){return`${t}px`}!function(t){t.normal="Normal",t.search="Search"}(t||(t={}));class s extends HTMLElement{constructor(){super(),this.attributeChangedCallback=(t,e,n)=>{console.log(t,e,n)},this.recordPosition=t=>{const[e,n]=[parseInt(this.style.top),parseInt(this.style.left)],{pageX:o,pageY:s}=t;document.body.style.userSelect="none",this.state.adjustment=[e-s,n-o],this.state.dragging=!0,this.container.classList.add("dragging")},this.drag=t=>{if(this.state.dragging){const[e,n]=this.state.adjustment;this.style.top=o(t.pageY+e),this.style.left=o(t.pageX+n)}},this.updatePosition=(t,e)=>{this.style.top=o(t),this.style.left=o(e)},this.attachShadow({mode:"open"}),this.state={dragging:!1,adjustment:[0,0]},this.container=document.createElement("div");const t=document.createElement("h3");t.textContent=this.hasAttribute("header-text")?this.getAttribute("header-text"):"Note";const e=document.createElement("textarea");t.classList.add("header"),e.classList.add("input"),this.container.classList.add("container"),this.container.appendChild(t),this.container.appendChild(e);const s=document.createElement("style");s.textContent=i,this.input=e;const r=document.body.style.userSelect;return this.input.onmousedown=n,this.container.onmousedown=this.recordPosition,document.onmousemove=this.drag,this.container.onmouseup=()=>{document.body.style.userSelect=r,this.state.dragging=!1,this.container.classList.remove("dragging")},this.shadowRoot.append(s,this.container),this}}const i="\n  .header {\n    font-family: sans serif;\n  }\n  .container {\n    opacity: 0.6;\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    background-color: yellow;\n    cursor: pointer;\n    padding: 0.5rem 0.5rem 0 0.5rem;\n  }\n\n  .input {\n    resize: none;\n    width: 100%;\n    height: 70%;\n  }\n\n  .dragging {\n    opacity: 0.2;\n    background-color: purple;\n    transform: translate(20deg);\n  }\n";customElements.define("share-note",s);const r=document.createElement("style");r.textContent="\n  share-note {\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    backgroundColor: red;\n  }\n",document.body.append(r),function(t){t.body.style.border="3px solid green"}(document);const c=["TEXTAREA","INPUT"],a={normal:"Backslash",search:"Forwardslash"},d=new class{constructor(t){this._contextEntries=t,this._currentContext="",this._action="",this._object=""}clear(){this._currentContext="",this._action="",this._object=""}triggerContext(e){if(this.inContext)return!1;switch(e){case this._contextEntries.normal:return this._currentContext=t.normal,!0;case this._contextEntries.search:return this._currentContext=t.search,!0;default:return this._currentContext="",!1}}add(t){return this.inContext?""===this._action?this._action=t:""===this._object&&(this._object=t):this.triggerContext(t),this}get sequenceComplete(){return!!this._action&&!!this._object}get inContext(){return""!==this._currentContext}get sequence(){return[this._action,this._object].join("-")}get contextEntries(){return this._contextEntries}set contextEntries(t){this._contextEntries=t}get currentContext(){return this._currentContext}}(a);document.addEventListener("keydown",(n=>{return c.includes(document.activeElement.nodeName)?null:d.add(n.code).sequenceComplete?"Escape"===n.code?(d.clear(),null):(d.add(n.code),void(d.currentContext===t.normal?(t=>{switch(t){case"KeyA-KeyN":console.log("Add Note Path Hit"),function(t){console.log("trying to place a note");const n=t.anchorNode;n instanceof HTMLElement?function(t){const n=e(t,{anchorOffset:0}),o=document.createElement("share-note");o.updatePosition(...n),document.body.appendChild(o)}(n):function(t,n){const o=e(t,{anchorOffset:n.anchorOffset}),s=document.createElement("share-note");s.updatePosition(...o),document.body.appendChild(s),s.input.focus()}(n,t)}(document.getSelection());break;case"KeyA-KeyA":console.log("Add Question Note Path Hit");break;case"KeyN-KeyV":console.log("Make the notes invisible!");break;default:console.log(`Not a configured normal mode action sequence ${t}`)}})(d.sequence):d.currentContext===t.search&&(o=d.sequence,console.log(`Not a configured search mode action sequence ${o}`)))):null;var o})),document.addEventListener("keyup",(t=>{d.sequenceComplete&&d.clear()})),document.addEventListener("selectionchange",(t=>{""===document.getSelection().toString()&&d.clear(),d.inContext||d.triggerContext(a.normal)}))})();