(()=>{"use strict";var t;function e(t,e){if(null===t)return n(0,0);let o=t.parentElement||t,s=0,r=e.anchorOffset||0;do{s+=o.offsetTop||0,r+=o.offsetLeft||0,o=o.offsetParent}while(o);return n(s,r)}function n(t,e){return[["top",`${t}px`],["left",`${e}px`]]}function o(t,e){return e.forEach((e=>{const[n,o]=e;t.style[n]=o})),t}function s(t){t.stopImmediatePropagation()}!function(t){t.normal="Normal",t.search="Search"}(t||(t={}));class r extends HTMLElement{constructor(){super(),this.attributeChangedCallback=(t,e,n)=>{console.log(t,e,n)},this.recordPosition=t=>{const[e,n]=[parseInt(this.style.top),parseInt(this.style.left)],{pageX:o,pageY:s}=t;document.body.style.userSelect="none",this.state.adjustment=[e-s,n-o],this.state.dragging=!0,this.container.classList.add("dragging")},this.drag=t=>{if(this.state.dragging){const[e,n]=this.state.adjustment;this.style.top=`${t.pageY+e}`,this.style.left=`${t.pageX+n}`}},this.attachShadow({mode:"open"}),this.state={dragging:!1,adjustment:[0,0]},this.container=document.createElement("div");const t=document.createElement("h3");t.textContent=this.hasAttribute("header-text")?this.getAttribute("header-text"):"Note";const e=document.createElement("textarea");t.classList.add("header"),e.classList.add("input"),this.container.classList.add("container"),this.container.appendChild(t),this.container.appendChild(e);const n=document.createElement("style");n.textContent=i,this.input=e;const o=document.body.style.userSelect;return this.input.onmousedown=s,this.container.onmousedown=this.recordPosition,document.onmousemove=this.drag,this.container.onmouseup=()=>{document.body.style.userSelect=o,this.state.dragging=!1,this.container.classList.remove("dragging")},this.shadowRoot.append(n,this.container),this}}const i="\n  .header {\n    font-family: sans serif;\n  }\n  .container {\n    opacity: 0.6;\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    background-color: yellow;\n    cursor: pointer;\n    padding: 0.5rem 0.5rem 0 0.5rem;\n  }\n\n  .input {\n    resize: none;\n    width: 100%;\n    height: 70%;\n  }\n\n  .dragging {\n    opacity: 0.2;\n    background-color: purple;\n    transform: translate(20deg);\n  }\n";customElements.define("share-note",r);const c=document.createElement("style");c.textContent="\n  share-note {\n    position: absolute;\n    width: 200px;\n    height: 200px;\n    backgroundColor: red;\n  }\n",document.body.append(c),function(t){t.body.style.border="3px solid green"}(document);const a=["TEXTAREA","INPUT"],d={normal:"Backslash",search:"Forwardslash"},h=new class{constructor(t){this._contextEntries=t,this._currentContext="",this._action="",this._object=""}clear(){this._currentContext="",this._action="",this._object=""}triggerContext(e){if(this.inContext)return!1;switch(e){case this._contextEntries.normal:return this._currentContext=t.normal,!0;case this._contextEntries.search:return this._currentContext=t.search,!0;default:return this._currentContext="",!1}}add(t){return this.inContext?""===this._action?this._action=t:""===this._object&&(this._object=t):this.triggerContext(t),this}get sequenceComplete(){return!!this._action&&!!this._object}get inContext(){return""!==this._currentContext}get sequence(){return[this._action,this._object].join("-")}get contextEntries(){return this._contextEntries}set contextEntries(t){this._contextEntries=t}get currentContext(){return this._currentContext}}(d);document.addEventListener("keydown",(n=>{return a.includes(document.activeElement.nodeName)?null:h.add(n.code).sequenceComplete?"Escape"===n.code?(h.clear(),null):(h.add(n.code),void(h.currentContext===t.normal?(t=>{switch(t){case"KeyA-KeyN":console.log("Add Note Path Hit"),function(t){console.log("trying to place a note");const n=t.anchorNode;n instanceof HTMLElement?function(t){const n=e(t,{anchorOffset:0}),s=o(document.createElement("share-note"),n);document.body.appendChild(s)}(n):function(t,n){const s=e(t,{anchorOffset:n.anchorOffset}),r=o(document.createElement("share-note"),s);document.body.appendChild(r),r.input.focus()}(n,t)}(document.getSelection());break;case"KeyA-KeyA":console.log("Add Question Note Path Hit");break;case"KeyN-KeyV":console.log("Make the notes invisible!");break;default:console.log(`Not a configured normal mode action sequence ${t}`)}})(h.sequence):h.currentContext===t.search&&(s=h.sequence,console.log(`Not a configured search mode action sequence ${s}`)))):null;var s})),document.addEventListener("keyup",(t=>{h.sequenceComplete&&h.clear()})),document.addEventListener("selectionchange",(t=>{""===document.getSelection().toString()&&h.clear(),h.inContext||h.triggerContext(d.normal)}))})();