(()=>{"use strict";var e;function t(e,t){if(null===e)return o(0,0);let n=e.parentElement||e,r=0,c=t.anchorOffset||0;do{r+=n.offsetTop||0,c+=n.offsetLeft||0,n=n.offsetParent}while(n);return o(r,c)}!function(e){e.normal="Normal",e.search="Search"}(e||(e={}));function n(e){const t=document.body.style.userSelect;e.onmousedown=()=>{document.body.style.userSelect="none",e.classList.add("dragging")},document.onmousemove=(e=>t=>{e.classList.contains("dragging")&&c(e,function(e){return o(e.pageY,e.pageX)}(t))})(e),e.onmouseup=()=>{document.body.style.userSelect=t,e.classList.remove("dragging")}}function o(e,t){return[["top",r(e)],["left",r(t)]]}function r(e){return`${e}px`}function c(e,t){return t.forEach((t=>{const[n,o]=t;e.style[n]=o})),e}const s=[["backgroundColor","purple"],["border","1px solid red"]],i=[["position","absolute"],["width","100px"],["height","100px"],["backgroundColor","red"],["opacity","0.5"],["cursor","pointer"]];!function(e){e.body.style.border="3px solid green"}(document);const a=["TEXTAREA","INPUT"],u={normal:"Backslash",search:"Forwardslash"},d=new class{constructor(e){this._contextEntries=e,this._currentContext="",this._action="",this._object=""}clear(){this._currentContext="",this._action="",this._object=""}triggerContext(t){if(this.inContext)return!1;switch(t){case this._contextEntries.normal:return this._currentContext=e.normal,!0;case this._contextEntries.search:return this._currentContext=e.search,!0;default:return this._currentContext="",!1}}add(e){return this.inContext?""===this._action?this._action=e:""===this._object&&(this._object=e):this.triggerContext(e),this}get sequenceComplete(){return!!this._action&&!!this._object}get inContext(){return""!==this._currentContext}get sequence(){return[this._action,this._object].join("-")}get contextEntries(){return this._contextEntries}set contextEntries(e){this._contextEntries=e}get currentContext(){return this._currentContext}}(u);document.addEventListener("keydown",(o=>{return a.includes(document.activeElement.nodeName)?null:d.add(o.code).sequenceComplete?"Escape"===o.code?(d.clear(),null):(d.add(o.code),void(d.currentContext===e.normal?(e=>{switch(e){case"KeyA-KeyN":console.log("Add Note Path Hit"),function(e){const o=e.anchorNode;o instanceof HTMLElement?function(e){const o=t(e,{anchorOffset:0}),r=c(document.createElement("span"),s);r.textContent=e.textContent,e.innerHTML=r.outerHTML;const a=c(document.createElement("div"),[...i,...o]);n(a),document.body.appendChild(a)}(o):function(e,o){const r=t(e,{anchorOffset:o.anchorOffset}),a=c(document.createElement("span"),s);a.textContent=e.textContent,e.parentElement.innerHTML=a.outerHTML;const u=c(document.createElement("div"),[...i,...r]);n(u),document.body.appendChild(u)}(o,e)}(document.getSelection());break;case"KeyA-KeyA":console.log("Add Question Note Path Hit");break;case"KeyN-KeyV":console.log("Make the notes invisible!");break;default:console.log(`Not a configured normal mode action sequence ${e}`)}})(d.sequence):d.currentContext===e.search&&(r=d.sequence,console.log(`Not a configured search mode action sequence ${r}`)))):null;var r})),document.addEventListener("keyup",(e=>{d.sequenceComplete&&d.clear()})),document.addEventListener("selectionchange",(e=>{""===document.getSelection().toString()&&d.clear(),d.inContext||d.triggerContext(u.normal)}))})();